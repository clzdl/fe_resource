function getQuery(){var e,t=window.location.search.substr(1),n=t.split("&"),a=n?n.length:0,o=0,i={};Array.slice;if(0==a)return{};for(;o<a;o++)-1!=(e=n[o].indexOf("="))&&(i[n[o].substr(0,e)]=unescape(n[o].substr(e+1)));return i}function getQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}getQueryString("from")&&(window.location.href="http://event.easteat.com/wx/oauth/getauthorizeurlbyjs/1/?scope=snsapi_base&redirectUrl="+encodeURIComponent("http://event.easteat.com/register/danmai.html").toLowerCase()),$(function(){function e(e,t){e.text(t).fadeIn().delay(500).fadeOut()}function t(e){$.ajax({url:f,type:"POST",async:!0,cache:!1,data:{orderId:e.orderId},success:function(e){e.flag&&1===e.flag?e.data.payResult&&(clearInterval(o),alert("稍后有工作人员联系您")):(clearInterval(o),alert("订单取消"))}})}function n(e){console.log("**wxpost**"),console.log(e),console.log("**wxpost**"),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},function(n){"get_brand_wcpay_request:ok"==n.err_msg?(t(e),o=setInterval(function(){t(e)},2e3)):alert("订单取消")})}function a(){var t=r.val(),a=c.val(),o=getQuery(),l=i.val();o.payNum=l,o.field0=t,o.field1=a,o.activityEnName=u,console.log(o),console.log("***",o),$.ajax({url:g,async:!0,cache:!1,type:"POST",data:o,error:function(t,n,a){e(s,"请重新点击")},success:function(t){if(t.flag&&1===t.flag&&t.data){var a=t.data.brandWCPayRequest;console.log(a),"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",function(){n(a)},!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",function(){n(a)}),document.attachEvent("onWeixinJSBridgeReady",function(){n(a)})):n(a)}else e(s,"系统异常稍后再试"),console.log(t)}})}console.log("start");var o,i=$("#num"),r=$("#name"),c=$("#tele"),s=$(".tip-text"),l=/^1\d{10}$/,u=(window.location.href,"dmktp"),d="http://event.easteat.com",g=d+"/register/saveandpay.json",f=d+"/wx/pay/payresult.json";$.ajax({url:d+"/register/activityinfo.json",type:"POST",data:{activityEnName:u},success:function(e){e.flag&&1===e.flag&&(console.log(e.data.activityInfo.registerCnt),$("#rs").text(e.data.activityInfo.registerCnt))}}),$("#add").on("click",function(){i.val(parseInt(i.val())+1)}),$("#dele").on("click",function(){i.val(parseInt(i.val()-1)>1?i.val()-1:1)}),$("#post").on("click",function(){var t=r.val(),n=c.val();return""==t?(e(s,"姓名不能为空"),!1):l.test(n)?void a():(e(s,"电话号码格式错误"),!1)})});